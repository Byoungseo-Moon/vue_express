<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.7.1.js"
        integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <style>
        table,
        tr,
        td,
        th {
            border: 1px solid black;
            border-collapse: collapse;
            padding: 5px 10px;
            text-align: center;
        }

        th {
            background-color: aqua;
        }

        tr:nth-child(even) {
            background-color: beige;
        }
    </style>


</head>

<body>
    <div id="app">
        <!-- id div tag안에서 html코드가 작성되어야 한다 
         @@@@ 서버쪽 변수들과 synch하고 실행시킬 것-->




    </div>
</body>

</html>

<script>
    export default {
        data() {
            return {
                productName: '',
                description: '',
                price: 0,
                stock: 0,
                category: '',
                selectedFile: null
            };
        },
        methods: {
            // 함수(메소드) - (key : function())
            fnFileChange(event) {
                this.selectedFile = event.target.files[0];
            },
            async fnSaveProduct() {
                const payload = {
                    productName: this.productName,
                    description: this.description,
                    price: this.price,
                    stock: this.stock,
                    category: this.category
                };

                const response = await fetch("http://localhost:3000/product/add", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();

                if (this.selectedFile && data.result.insertId) {
                    this.fnUploadFile(data.result.insertId);
                }
            },
            async fnUploadFile(productId) {
                const formData = new FormData();
                formData.append("file", this.selectedFile);
                formData.append("productId", productId);

                try {
                    const res = await fetch("http://localhost:3000/product/upload", {
                        method: "POST",
                        body: formData
                    });

                    const data = await res.json();
                    console.log("파일 업로드 완료", data);
                } catch (err) {
                    console.error("파일 업로드 실패", err);
                }
            }
        }, // methods

        mounted() {
            // 처음 시작할 때 실행되는 부분
            let self = this; // 꼭먼저 쓸것
        }
    };
</script>